!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).rocketjs=t()}(this,function(){"use strict";function y(e,t){let r=0,l=e.indexOf(t);for(;-1!==l;)r++,l=e.indexOf(t,l+1);return r}function e(){return{sequence:"",match:!1}}function v(e,t,r){let l=r.sequence;return l.length===t.length&&(l=l.substring(1)),l+=e,r.sequence=l,r.match=l===t,r}class g{static getTemplates(t,r,l){if(r.length!==l.length)throw new Error("Template start is not the same length as template end");var g=t.length;let a=e(),o=e(),n=0,s=0,i=[],p=[];const u=[];for(let e=0;e<g;e++)if(a=v(t[e],r,a),o=v(t[e],l,o),a.match&&(n+=1,i.push(e-(r.length-1))),o.match&&(s+=1,p.push(e+1)),0<n&&0<s&&n===s){var m=i.length;for(let e=0;e<m;e++){var f=i[e];for(let e=0;e<m;e++)if(!((c=p[e])<f)){var c,T=y(c=t.substring(f,c),r),h=y(c,l);if(0<T&&0<h&&T===h&&c.length){u.push(c);break}}}n=0,s=0,i=[],p=[]}return u}static getToplevelTemplates(e){const r=[];for(var[l,a]of e.entries()){let t=!0;for(let e=0;e<l;e++){const o=r[e];if(o&&o.includes(a)){t=!1;break}}t&&r.push(a)}return r}static getInnerTemplate(e,t=3){var r=e.length-t;return e.substring(t,r).trim()}static getConditionalLogic(e){const t={truthy:!0},r=g.getInnerTemplate(e),l=g.getLogicString(r);t.logiclessTemplate=r.substring(l.length).trim();let a=l.substring(2).trim().split(" ");return e=a.length,t.property=a[0],a.shift(),1<e&&(t.truthy="is"===a[0],a.shift(),t.comparison=a.join(" ")),t}static getLoopLogic(e){const t={},r=g.getInnerTemplate(e),l=g.getLogicString(r);return t.templateToRepeat=r.replace(l,"").trim(),e=l.substring(3).trim().split(" "),t.imaginaryProp=e[0],t.property=e[2],t}static getWrapperProperty(e){const t={},r=g.getInnerTemplate(e),l=g.getLogicString(r);return t.property=l.substring(4).trim(),t.templateToFill=r.replace(l,""),t}static getProperty(e){let t="";switch(e.substring(2,3)){case"%":var r=g.getLoopLogic(e);t=r.property;break;case"~":r=g.getConditionalLogic(e),t=r.property;break;case"#":t=g.getInnerTemplate(e,3).trim();break;default:r=g.getInnerTemplate(e,2),t="!"===r[0]?trim(r):r}return t}static getPropertyValue(e,t){let r="";for(const l of e.split(".")){const e=l.trim();if(r&&Object.keys(r).length){if("object"!=typeof r||!r[e]){r=null;break}r=r[e]}else r=t[e]||""}return r}static getLogicString(t){let r="";const l=["\n","{","<"];var a=t.length;for(let e=0;e<a;e++){var o=t[e];if(l.includes(o))return r;r+=o}return r}}class c{static resolveLoop(e,t){let r=e;var l=g.getTemplates(e,"{{%","%}}");for(const i of g.getToplevelTemplates(l)){var a=g.getLoopLogic(i),o=a.property,n=a.imaginaryProp,s=a.templateToRepeat;if(a=g.getPropertyValue(o,t)){let e="";for(const p of Object.keys(a))e+=c.replacePropWithTrail(s,n,isNaN(p)?o:o+"."+p);r=r.replace(i,e)}}if(r.includes("{{%")){if(r===e)return r;r=c.resolveLoop(r,t)}return r}static replacePropWithTrail(e,t,r){let l=e.replace(/\{\{(.+?)\}\}/gm,e=>e.replace(new RegExp(t,"g"),r));return l=l.replace(/if([\s\S]+?)\s|is|not/gm,e=>e.replace(new RegExp(t,"g"),r)),l=l.replace(/(of|in)([\s\S]+?)(?=<|{)/gm,e=>e.replace(new RegExp(t,"g"),r)),l}}class o{static resolvePartials(e,t){let r=e;for(const a of g.getTemplates(e,"{{#","#}}")){var l=g.getInnerTemplate(a),l=g.getPropertyValue(l,t);r=r.replace(a,l||"")}if(r.includes("{{#")){if(e===r)return r;r=o.resolvePartials(r,t)}return r}}class s{static interpolateTemplate(e,r){let l=e;for(const n of g.getTemplates(e,"{{","}}")){let e=g.getInnerTemplate(n,2);var a="!"===e[0],o=(a&&(e=e.substr(1).trim()),g.getPropertyValue(e,r));let t=o||"";t=Array.isArray(t)?t.join(", "):t.toString().trim(),o=a?s.escapeHtml(t):t,l=l.replace(n,o)}return l}static escapeHtml(e){return(e=(e=(e=(e=e.replace(/&/gm,"&amp;")).replace(/</gm,"&lt;")).replace(/>/gm,"&gt;")).replace(/"/gm,"&quot;")).replace(/\//gm,"&#039;")}}class r{static buildTemplate(e,t){return e=o.resolvePartials(e,t),e=class{static resolveWrapper(e){let t=e;for(const o of g.getTemplates(e,"{{$","$}}")){var r=g.getWrapperProperty(o),l=g.getTemplates(r.templateToFill,"{{","}}"),l=g.getToplevelTemplates(l);let e=r.templateToFill;for(const n of l){var a=g.getProperty(n);e=e.replace(new RegExp(a,"g"),r.property+"."+a)}t=t.replace(o,e)}return t}}.resolveWrapper(e),e=c.resolveLoop(e,t),class{static resolveConditional(e,l){let a=e;for(const p of g.getTemplates(e,"{{~","~}}")){const c=g.getConditionalLogic(p);var o=c.property,n=c.logiclessTemplate,s=c.truthy,i=!c.truthy;let e="",t=(c.comparison&&(e=c.comparison),""),r=g.getPropertyValue(o,l);r&&(r=Array.isArray(r)?r:r.toString().trim().toLocaleLowerCase(),e=c.comparison?c.comparison.toLocaleLowerCase():null),e?(s&&(t=r===e?n:""),i&&(t=r!==e?n:"")):t="false"===r||!r||Array.isArray(r)&&!r.length?"":n,a=a.replace(p,t)}return a}}.resolveConditional(e,t)}static interpolateTemplate(e,t){return s.interpolateTemplate(e,t)}static render(e,t){return e=r.buildTemplate(e,t),r.interpolateTemplate(e,t)}}return r});